<div>
    <hr>
    <ul class="breadcrumb">
        <li>
            <a href="/">Home</a> <span class="divider">/</span>
        </li>
        <li>Failed Messages</li>
    </ul>
    <hr>
</div>
<h3>Total number of messages in the error queue: {{model.number_of_failed_messages}}</h3>
<div class="row-fluid sortable">
    <div class="box span12">
        <div class="box-header" data-original-title>
            <h2><i class="fa-icon-search"></i><span class="break"></span>Narrow your search</h2>
        </div>
        <div class="box-content" style="min-height:225px; height:auto !important;">

            <div class="span2" style="float:left;">
                <h3>Machines</h3>
                <ul style="list-style-type: none; padding:0; margin:0">
                    <li ng-repeat="msg in model.failedMessagesStats['machines'].values">{{msg.range}} <strong>({{msg.hits}})</strong></li>
                </ul>
            </div>
            <div class="span3" style="float:left;">
                <h3>Endpoints</h3>
                <ul style="list-style-type: none; padding:0; margin:0">
                    <li ng-repeat="msg in model.failedMessagesStats['endpoints'].values">{{msg.range}} <strong>({{msg.hits}})</strong></li>
                </ul>
            </div>
            <div class="span7" style="float:left;">
                <h3>Message Types</h3>
                <ul style="list-style-type: none; padding:0; margin:0">
                    <li ng-repeat="msg in model.failedMessagesStats['message types'].values">{{msg.range}} <strong>({{msg.hits}})</strong></li>
                </ul>
            </div>
            <br style="clear: left;" />

            <hr>
            <div class="control-group">
                <select multiple style="width:350px;" data-placeholder="Select your filter criteria" ui-select2="" ng-model="model.selectedTags">
                    <option ng-repeat="tag in model.tags" value="{{tag.id}}">{{tag.label}}</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
            <button class="btn">Clear</button>

        </div>
    </div>

</div>
<div class="row-fluid sortable">
    <div class="box span12">
        <div class="box-header" data-original-title>
            <h2><i class="fa-icon-envelope"></i><span class="break"></span>Messages that match criteria: {{model.number_of_failed_messages}}</h2>
        </div>
        <div class="box-content">
            <div class="btn-toolbar">
                <button class="btn" id="reprocess-selected" ng-click="retrySelected()" ng-disabled="model.selectedMessages.length == 0"><i class="icon-repeat"></i> Retry {{getSelected().length}} selected</button>
                <button class="btn" id="reprocess-all" ng-click="retryAll()"><i class="icon-asterisk"></i> Retry all ({{model.number_of_failed_messages}} messages)</button>
                <div class="btn-group pull-right">
                    <a class="btn btn-link dropdown-toggle"
                       data-toggle="dropdown"
                       href="#">
                        Sort by
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#/failedMessages?sort=message_type">Message Type</a></li>
                        <li><a href="#/failedMessages?sort=time_sent">Time Sent</a></li>
                    </ul>
                </div>
            </div>
            <div class="scRow" ng-repeat="row in model.failedMessages">
                <div class="row-fluid scSelectableRow" ng-class="{rowSelected: row.selected == true}" ng-click="row.selected = !row.selected" style="cursor: pointer;">
                    <div class="span1" style="margin-left: 5px; width: 0;"><input type="checkbox" ng-checked="row.selected"></div>
                    <div class="span11">
                        <div class=" row-fluid">
                            <div class="span4" title="Endpoint: {{row.receiving_endpoint.name}}@{{row.receiving_endpoint.machine}}">{{row.receiving_endpoint.name}}@{{row.receiving_endpoint.machine}}</div>
                            <div class="span6 rowText" title="Message Type: {{row.message_type}}">{{row.message_type}}</div>
                            <div class="span2"><sp-moment date="{{row.time_sent}}" /></div>
                        </div>
                        <div class="row-fluid">
                            <div class="span12"><code>{{row.failure_details.exception.message}}</code></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
     </div>
</div>
