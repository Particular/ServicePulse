<div>
    <hr>
    <ul class="breadcrumb">
        <li>
            <a href="/">Home</a> <span class="divider">/</span>
        </li>
        <li>Failed Messages</li>
    </ul>
    <hr>
</div>
<h3>Total number of messages in the error queue: {{model.total_number_of_failed_messages}}</h3>
<div class="row-fluid">
    <div class="box span12">
        <div class="box-header" data-original-title>
            <h2><i class="fa-icon-info-sign"></i><span class="break"></span>Summary statistics</h2>
        </div>
        <div class="box-content">
            <div class="row-fluid">
                <div class=" span2">
                    <h3>Machines</h3>
                    <ul class="unstyled">
                        <li ng-repeat="msg in model.failedMessagesStats['machines'].values">
                            {{msg.range | limitTo: 30}}<span ng-show="msg.range.length > 30">...</span> <strong>({{msg.hits}})</strong>
                        </li>
                    </ul>
                </div>
                <div class="span3">
                    <h3>Endpoints</h3>
                    <ul class="unstyled">
                        <li ng-repeat="msg in model.failedMessagesStats['endpoints'].values">
                            {{msg.range | limitTo: 30}}<span ng-show="msg.range.length > 30">...</span> <strong>({{msg.hits}})</strong>
                        </li>
                    </ul>
                </div>
                <div class="span7">
                    <h3>Message Types</h3>
                    <ul class="unstyled">
                        <li ng-repeat="msg in model.failedMessagesStats['message types'].values">
                            {{msg.range | limitTo: 30}}<span ng-show="msg.range.length > 30">...</span> <strong>({{msg.hits}})</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row-fluid">
    <div class="box span12">
        <div class="box-header" data-original-title>
            <h2><i class="fa-icon-envelope"></i><span class="break"></span>Showing {{model.failedMessages.length}} message(s)</h2>
        </div>
        <div class="box-content">
            <div class="btn-toolbar">
                <button class="btn" ng-click="retrySelected()" ng-disabled="model.selectedMessages.length == 0"><i class="icon-repeat"></i> Retry {{getSelected().length}} selected</button>
                <button class="btn" ng-click="retryAll()"><i class="icon-asterisk"></i> Retry all ({{model.total_number_of_failed_messages}} messages)</button>
                <div class="btn-group pull-right">
                    <a class="btn btn-link dropdown-toggle"
                       data-toggle="dropdown"
                       href="#">
                        Sort by
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#/failedMessages?sort=message_type">Message Type</a></li>
                        <li><a href="#/failedMessages?sort=time_sent">Time Sent</a></li>
                    </ul>
                </div>
            </div>
            <div infinite-scroll="loadMoreResults()" infinite-scroll-distance="0" infinite-scroll-disabled="disableLoadingData">
                <div class="scRow" ng-repeat="row in model.failedMessages">
                    <div class="row-fluid scSelectableRow" ng-class="{rowSelected: row.selected == true}" ng-click="row.selected = !row.selected" style="cursor: pointer;">
                        <div class="span1" style="margin-left: 5px; width: 0;"><input type="checkbox" ng-checked="row.selected"></div>
                        <div class="span11">
                            <div class=" row-fluid">
                                <div class="span4" title="Endpoint: {{row.receiving_endpoint.name}}@{{row.receiving_endpoint.machine}}">{{row.receiving_endpoint.name}}@{{row.receiving_endpoint.machine}}</div>
                                <div class="span6 rowText" title="Message Type: {{row.message_type}}">{{row.message_type}}</div>
                                <div class="span2"><sp-moment date="{{row.time_sent}}" /></div>
                            </div>
                            <div class="row-fluid">
                                <div class="span12"><code>{{row.failure_details.exception.message}}</code></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-show='loadingData'>Loading more data...</div>
            </div>
         </div>
     </div>
</div>
