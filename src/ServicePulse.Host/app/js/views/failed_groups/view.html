<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <h1>Failed Messages</h1>
        </div>
    </div>
</div>
<div class="container">

    <section name="message_groups">

        <failed-message-tabs></failed-message-tabs>

        <busy ng-show="vm.loadingData" message="fetching more messages"></busy>

        <no-data ng-show="vm.exceptionGroups.length === 0 && !vm.loadingData" title="message groups" message="There are currently no grouped message failures"></no-data>

        <div class="row" ng-show="vm.availableClassifiers.length && vm.initialLoadComplete">
            <div class="col-sm-12">
                <div class="btn-group pull-right">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="hidden-xs hidden-sm">Grouped by </span>{{vm.selectedClassification}}
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li ng-repeat="classifier in vm.availableClassifiers">
                            <a href="javascript://" ng-click="vm.selectClassification(classifier)">{{classifier}}</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12" ng-show="vm.exceptionGroups.length">
                <div class="row box wf-{{group.workflow_state.status}} repeat-modify" ng-repeat="group in vm.exceptionGroups">
                    <div class="col-sm-12">
                        <div class="row" ng-show="group.workflow_state.status !=='ready'">

                            <div class="col-md-10">
                                <div class="row box-header" ng-show="group.workflow_state.status ==='submitted'">
                                    <div class="col-sm-12">
                                        <p class="lead">Submitted Group for retry: {{group.title}}</p>
                                        <p>The group was submitted for retry and will be retried when possible. When the processing starts, progress will be displayed on this screen. </p>
                                        <p>
                                            <strong>If you leave this screen or refresh the data in this list, messages may appear as if they have not been submited when you return. 
                                            When the processing will start it will be visually represented. </strong>
                                        </p>
                                    </div>
                                </div>
                                <div class="row box-header" ng-show="group.workflow_state.status === 'in_progress'">
                                    <div class="col-sm-12">
                                        <p class="lead">Processing Group {{group.title}}</p>
                                        <p>Group is being processed, {{group.workflow_state.total}} messages remaining </p>
                                        <p>
                                            <strong> Please be patient. </strong>
                                        </p>
                                    </div>
                                </div>
                                <div class="row box-header" ng-show="group.workflow_state.status === 'done'">
                                    <div class="col-sm-12">
                                        <p class="lead">Group retry complete {{group.title}}</p>
                                        <p>Processed {{group.workflow_state.total}} messages </p>
                                        <p>
                                            <button type="button" class="btn btn-link btn-sm hidden-sm-down" ng-click="vm.closeStatus(group)">
                                                OK
                                            </button>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-2" ng-show="group.workflow_state.status !== 'done'">
                                <i class="fa fa-spinner fa-pulse fa-5x pull-right"></i>
                            </div>
                        </div>
                        <div class="row" ng-show="group.workflow_state.status ==='ready'">
                            <div class="col-sm-12">
                                <div class="row box-header">
                                    <div class="col-sm-12" ng-click="vm.viewExceptionGroup(group)">
                                        <p class="lead break"> {{group.title}}</p>
                                        <p class="metadata">
                                            <span class="metadata"><i class="fa fa-envelope"></i> {{group.count | number}} message<span ng-show="group.count >1">s</span></span>

                                            <span class="metadata"><i class="fa fa-clock-o"></i> Last failed: <sp-moment date="{{group.last}}"></sp-moment></span>

                                            <span class="metadata"><i class="fa fa-clock-o"></i> First failed: <sp-moment date="{{group.first}}"></sp-moment></span>
                                        </p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <button type="button" class="btn btn-link btn-sm hidden-sm-down" title="View messages in this Group" ng-click="vm.viewExceptionGroup(group)" ng-disabled="group.count == 0">
                                            View Messages
                                        </button>
                                        <button type="button" class="btn btn-link btn-sm" title="Retry messages in this Group" confirm-click="vm.retryExceptionGroup(group)" ng-disabled="group.count == 0 || group.workflow_state.status !== 'ready'" confirm-title="Are you sure you want to retry this group?" confirm-message="Retrying a whole group can take some time and put extra load on your system. Are you sure you want to retry this group of {{group.count}} messages?">
                                            Retry Group
                                        </button>
                                        <button type="button" class="btn btn-link btn-sm" title="Archive messages in this Group" confirm-click="vm.archiveExceptionGroup(group)" ng-disabled="group.count == 0 || group.workflow_state.status !== 'ready'" confirm-title="Are you sure you want to archive this group?" confirm-message="If you do, they will not be available for Retry.">
                                            Archive Group
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </section>
</div>



